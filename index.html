<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>í•œêµ­ì „ë ¥ê¸°ìˆ _Power to Dream Together_ì´ˆë“± ê³ í•™ë…„</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;background:#f7fafc;color:#1f2937}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    h1{font-size:28px;font-weight:800;text-align:center;margin-bottom:16px}
    .sub{color:#6b7280;text-align:center;margin-bottom:28px}
    .grid{display:grid;gap:24px;grid-template-columns:1fr}
    @media(min-width:1024px){.grid{grid-template-columns:420px 1fr}}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:18px}
    .row{display:flex;gap:8px;align-items:center;margin-bottom:10px}
    .btn{border:0;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
    .btn-gray{background:#e5e7eb}
    .btn-blue{background:#2563eb;color:#fff}
    .btn-ghost{background:#eef2ff;color:#3730a3}
    .btn-full{width:100%}
    .small{font-size:12px;color:#6b7280}
    input[type=number]{width:110px;padding:8px;border:1px solid #d1d5db;border-radius:8px}
    input[type=number]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 1px #2563eb}
    .trash{background:transparent;border:0;font-size:18px;cursor:pointer;color:#ef4444}
    .legend{display:flex;gap:16px;justify-content:center;margin-top:10px}
    .dot{width:14px;height:14px;border-radius:50%}
    .line{width:20px;height:4px;border-radius:2px}
    .empty{display:flex;align-items:center;justify-content:center;height:420px;border:2px dashed #d1d5db;border-radius:12px;color:#6b7280}
    .svg{background:#fff;border:1px solid #e5e7eb;border-radius:12px}
    .result{margin-top:10px;padding:12px;border-radius:10px;background:#ecfeff;border:1px solid #a5f3fc;color:#0e7490;font-weight:800}
    .section-title{font-size:18px;font-weight:800;margin-bottom:8px}
    .muted{color:#6b7280}
    .pill{display:inline-flex;align-items:center;gap:6px;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:999px;padding:6px 10px;font-size:13px}
    .warn{margin-top:8px;color:#b45309;background:#fffbeb;border:1px solid #fcd34d;border-radius:10px;padding:8px 10px;display:none}
  </style>
</head>
<body>
  <div class="container">
    <h1>ê¸°ì˜¨ì— ë”°ë¥¸ ì „ë ¥ëŸ‰ì„ <span style="white-space:nowrap">ê·¸ë¦¼ìœ¼ë¡œ ì˜ˆì¸¡í•˜ê¸°</span> âš¡</h1>
    <p class="sub">x=ğŸŒ¡ï¸ <b>ê¸°ì˜¨(â„ƒ)</b>, y=âš¡ <b>ì „ë ¥ëŸ‰(GWh)</b> </p>

    <div class="grid">
      <!-- ì™¼ìª½: ì…ë ¥/ë²„íŠ¼ -->
      <div class="card">
        <div class="section-title">ìˆ«ì ë„£ê¸°</div>
        <p class="small" style="margin-bottom:10px">ì˜ˆ: (ê¸°ì˜¨, ì „ë ¥) â†’ (30, 24)</p>
        <div id="rows"></div>
        <button class="btn btn-ghost" onclick="addRow()">â• ì¤„ ì¶”ê°€</button>

        <div style="display:flex;flex-direction:column;gap:10px;margin-top:16px">
          <button id="showBtn" class="btn btn-gray btn-full" onclick="togglePoints()">ì  ì°ê¸°</button>
          <button id="lineBtn" class="btn btn-gray btn-full" onclick="toggleLine()" disabled>ëŒ€í‘œì„  ì•Œì•„ë³´ê¸°</button>
          <button id="sampleBtn" class="btn btn-ghost btn-full" onclick="loadSample()">ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn btn-ghost btn-full" onclick="clearAll()">ì „ì²´ ì§€ìš°ê¸°</button>
        </div>

        <div style="margin-top:18px">
          <div class="section-title">ì˜ˆì¸¡í•˜ê¸°</div>
          <p class="small muted" style="margin-bottom:8px">ğŸŸ¦ ì ì„ ë¨¼ì € ì°ê³ , ëŒ€í‘œì„ ì„ ê·¸ë¦° ë’¤ ì‚¬ìš©í•˜ì„¸ìš”.</p>
          <div class="row">
            <span class="pill">ğŸŒ¡ï¸ ë‚´ì¼ ê¸°ì˜¨(â„ƒ)</span>
            <input type="number" id="predictX" placeholder="ì˜ˆ: 33" />
            <button class="btn btn-blue" onclick="predict()">ì˜ˆì¸¡í•˜ê¸°</button>
          </div>
          <div id="rangeWarn" class="warn">ê´€ì¸¡ ë²”ìœ„ ì•ˆì—ì„œë§Œ ì˜ˆì¸¡í•´ìš”! (í˜„ì¬ ë²”ìœ„: <span id="rangeText"></span>â„ƒ)</div>
          <div id="result" class="result" style="display:none"></div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ê·¸ë˜í”„ -->
      <div class="card">
        <div class="row" style="justify-content:space-between;margin-bottom:6px">
          <div class="section-title">ê·¸ë˜í”„</div>
          <div class="row small muted">
            <span class="pill">Xì¶• ğŸŒ¡ï¸ ê¸°ì˜¨(â„ƒ)</span>
            <span class="pill">Yì¶• âš¡ ì „ë ¥(GWh)</span>
          </div>
        </div>
        <div id="blank" class="empty">ìˆ«ìë¥¼ ë„£ê³  <b>ì  ì°ê¸°</b>ë¥¼ ëˆŒëŸ¬ ë³´ì„¸ìš”</div>
        <svg id="svg" class="svg" width="640" height="420" style="display:none"></svg>

        <div class="legend">
          <div class="row small"><span class="dot" style="background:#2563eb"></span>ì…ë ¥ ì </div>
          <div class="row small"><span class="line" style="background:#dc2626"></span>ëŒ€í‘œì„ </div>
          <div class="row small"><span class="dot" style="background:#16a34a"></span>ì˜ˆì¸¡ ì </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ----- ìƒíƒœ -----
// ì²˜ìŒì—ëŠ” ë¹„ì–´ ìˆëŠ” ì…ë ¥ì¹¸ë§Œ í•˜ë‚˜
let points = [
  {id:1, x:'', y:''},
  {id:2, x:'', y:''},
  {id:3, x:'', y:''},
  {id:4, x:'', y:''},
  {id:5, x:'', y:''}
];
let show = false, line = false, pred = null;

    // ----- ì´ˆê¸° ë Œë” -----
    document.addEventListener('DOMContentLoaded', ()=>{
      renderRows();
      setBtnStates(); draw();
    });

    function renderRows(){
      const box = document.getElementById('rows');
      box.innerHTML = '';
      points.forEach(p=>{
        const div = document.createElement('div');
        div.className='row';
        div.innerHTML = `
          <span class="pill">#${p.id}</span>
          <span class="pill">ğŸŒ¡ï¸</span>
          <input type="number" placeholder="x(â„ƒ)" value="${p.x}"
            oninput="updatePoint(${p.id},'x',this.value)"/>
          <span class="pill">âš¡</span>
          <input type="number" placeholder="y(GWh)" value="${p.y}"
            oninput="updatePoint(${p.id},'y',this.value)"/>
          ${points.length>1?`<button class="trash" title="ì‚­ì œ" onclick="removeRow(${p.id})">ğŸ—‘ï¸</button>`:''}
        `;
        box.appendChild(div);
      });
    }

    function addRow(){
      const next = points.length? Math.max(...points.map(p=>p.id))+1 : 1;
      points.push({id:next,x:'',y:''});
      renderRows(); draw();
    }
    function removeRow(id){
      if(points.length<=1) return;
      points = points.filter(p=>p.id!==id);
      renderRows(); draw();
    }
    function updatePoint(id,key,val){
      const pt = points.find(p=>p.id===id);
      if(pt){ pt[key]=val; draw(); }
    }

    function valid(){
      return points
        .filter(p=>p.x!==''&&p.y!==''&&!isNaN(p.x)&&!isNaN(p.y))
        .map(p=>({x:parseFloat(p.x),y:parseFloat(p.y)}));
    }

    // ----- ë²„íŠ¼ -----
    function setBtnStates(){
      const showBtn = document.getElementById('showBtn');
      const lineBtn = document.getElementById('lineBtn');
      showBtn.className = 'btn '+(show?'btn-blue':'btn-gray')+' btn-full';
      if(!show){ line=false; pred=null; }
      const ok = valid().length>=2 && show;
      lineBtn.disabled = !ok;
      lineBtn.className = 'btn '+(ok?(line?'btn-blue':'btn-gray'):'btn-gray')+' btn-full';
    }
    function togglePoints(){ show=!show; setBtnStates(); draw(); }
    function toggleLine(){
      if(valid().length<2){ alert('ì ì´ 2ê°œ ì´ìƒ í•„ìš”í•´ìš”.'); return; }
      line=!line; setBtnStates(); draw();
    }

    // ----- ìƒ˜í”Œ ë°ì´í„° -----
    function loadSample(){
      const sets = [
        [
          {id:1,x:'29',y:'22'},
          {id:2,x:'30',y:'24'},
          {id:3,x:'28',y:'20'},
          {id:4,x:'27',y:'18'},
          {id:5,x:'26',y:'16'}
        ],
        [
          {id:1,x:'25',y:'18.5'},
          {id:2,x:'27',y:'21.5'},
          {id:3,x:'28',y:'23'},
          {id:4,x:'30',y:'26'},
          {id:5,x:'26',y:'20'}
        ],
        [
          {id:1,x:'26',y:'17'},
          {id:2,x:'27',y:'18.8'},
          {id:3,x:'29',y:'22.4'},
          {id:4,x:'30',y:'24.2'},
          {id:5,x:'28',y:'20.5'}
        ]
      ];
      points = sets[Math.floor(Math.random()*sets.length)];
      renderRows();
      show = true; line = true; pred=null; setBtnStates(); draw();
    }

    // ----- íšŒê·€ì„ (y=ax+b) -----
    function trend(pts){
      if(pts.length<2) return null;
      const n=pts.length;
      const sx=pts.reduce((s,p)=>s+p.x,0);
      const sy=pts.reduce((s,p)=>s+p.y,0);
      const sxx=pts.reduce((s,p)=>s+p.x*p.x,0);
      const sxy=pts.reduce((s,p)=>s+p.x*p.y,0);
      const denom = (n*sxx - sx*sx);
      if (Math.abs(denom) < 1e-9) return null; // ìˆ˜ì§/íŠ¹ì´ ì¼€ì´ìŠ¤ ë°©ì§€
      const a=(n*sxy - sx*sy)/denom;
      const b=(sy - a*sx)/n;
      return {a,b};
    }

    // ----- ì˜ˆì¸¡ -----
    function predict(){
      const pts = valid();
      const warn = document.getElementById('rangeWarn');
      const rangeText = document.getElementById('rangeText');
      if(!show || !line){ alert('ë¨¼ì € ì ì„ ì°ê³ , ëŒ€í‘œì„ ì„ ê·¸ë ¤ ì£¼ì„¸ìš”.'); return; }
      if(pts.length<2){ alert('ì ì´ 2ê°œ ì´ìƒ í•„ìš”í•´ìš”.'); return; }
      const t = trend(pts);
      if(!t){ alert('ëŒ€í‘œì„ ì„ ê³„ì‚°í•  ìˆ˜ ì—†ì–´ìš”.'); return; }

      const x = parseFloat(document.getElementById('predictX').value);
      if(isNaN(x)){ alert('ê¸°ì˜¨(â„ƒ)ì„ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }

      // ê´€ì¸¡ ë²”ìœ„ ì²´í¬
      const xs = pts.map(p=>p.x);
      const minObs = Math.min(...xs), maxObs = Math.max(...xs);
      rangeText.textContent = `${minObs} ~ ${maxObs}`;
      if (x < minObs || x > maxObs) {
        warn.style.display='block';
        return;
      } else {
        warn.style.display='none';
      }

      // ì˜ˆì¸¡ ë° ìŒìˆ˜ ì ˆì‚­
      let y = t.a * x + t.b;
      if (y < 0) y = 0;

      pred = {x,y};
      const res = document.getElementById('result');
      res.style.display='block';
      res.textContent = `ì˜ˆì¸¡ ê²°ê³¼: ğŸŒ¡ï¸ ${x.toFixed(1)}â„ƒ â†’ âš¡ ${y.toFixed(1)} GWh`;
      draw();
    }

    // ----- ê·¸ë˜í”„ -----
    function draw(){
      setBtnStates();
      const svg = document.getElementById('svg');
      const blank = document.getElementById('blank');
      const pts = valid();
      if(!show || pts.length===0){ svg.style.display='none'; blank.style.display='flex'; return; }
      svg.style.display='block'; blank.style.display='none';
      const W=640,H=420,P=56;
      svg.innerHTML='';

      // ë²”ìœ„
      let xs=pts.map(p=>p.x), ys=pts.map(p=>p.y);
      if(pred){ xs.push(pred.x); ys.push(pred.y); }
      let minX=Math.min(...xs), maxX=Math.max(...xs), minY=Math.min(...ys), maxY=Math.max(...ys);
      const padX=(maxX-minX||10)*0.1, padY=(maxY-minY||10)*0.1;
      minX-=padX; maxX+=padX; minY-=padY; maxY+=padY;
      const toX=x=> P + (x-minX)/(maxX-minX)*(W-2*P);
      const toY=y=> H-P - (y-minY)/(maxY-minY)*(H-2*P);

      // ê²©ì+ì¶•
      for(let i=0;i<=10;i++){
        const gx = P + i/10*(W-2*P);
        const gy = P + i/10*(H-2*P);
        lineEl(gx,P,gx,H-P,'#e5e7eb',1);
        lineEl(P,gy,W-P,gy,'#e5e7eb',1);
      }
      lineEl(P,P,P,H-P,'#374151',2);
      lineEl(P,H-P,W-P,H-P,'#374151',2);

      // ë ˆì´ë¸”
      for(let i=0;i<=5;i++){
        const vx = minX + i/5*(maxX-minX);
        textEl(toX(vx), H-P+22, vx.toFixed(1), 'middle', 12, '#6b7280');
        const vy = minY + i/5*(maxY-minY);
        textEl(P-10, toY(vy)+4, vy.toFixed(1), 'end', 12, '#6b7280');
      }
      textEl(W/2, H-8, 'ğŸŒ¡ï¸ ê¸°ì˜¨(â„ƒ)', 'middle', 14, '#111827', true);
      textEl(18, H/2, 'âš¡ ì „ë ¥(GWh)', 'middle', 14, '#111827', true, -90);

      // ëŒ€í‘œì„ 
      if(line && pts.length>=2){
        const t=trend(pts);
        if(t){
          const y1=t.a*minX+t.b, y2=t.a*maxX+t.b;
          lineEl(toX(minX),toY(y1),toX(maxX),toY(y2),'#dc2626',2.2);
          // ë°©ì •ì‹ í‘œì‹œ(ì°¸ê³ ìš©)
          textEl(P+10, P+18, `y = ${t.a.toFixed(2)}x + ${t.b.toFixed(2)}`, 'start', 13, '#dc2626', true);
        }
      }

      // ì 
      pts.forEach(p=>{
        circleEl(toX(p.x),toY(p.y),6,'#2563eb');
        textEl(toX(p.x),toY(p.y)-12,`(${p.x}, ${p.y})`,'middle',10,'#374151',true);
      });

      // ì˜ˆì¸¡ ì 
      if(pred){
        circleEl(toX(pred.x),toY(pred.y),7,'#16a34a');
        textEl(toX(pred.x),toY(pred.y)-14,`ì˜ˆì¸¡: ${pred.y.toFixed(1)} GWh`,'middle',12,'#16a34a',true);
      }

      // SVG ë„ìš°ë¯¸
      function lineEl(x1,y1,x2,y2,color,w){
        const el=document.createElementNS('http://www.w3.org/2000/svg','line');
        el.setAttribute('x1',x1); el.setAttribute('y1',y1);
        el.setAttribute('x2',x2); el.setAttribute('y2',y2);
        el.setAttribute('stroke',color); el.setAttribute('stroke-width',w);
        svg.appendChild(el);
      }
      function circleEl(cx,cy,r,fill){
        const el=document.createElementNS('http://www.w3.org/2000/svg','circle');
        el.setAttribute('cx',cx); el.setAttribute('cy',cy);
        el.setAttribute('r',r); el.setAttribute('fill',fill);
        svg.appendChild(el);
      }
      function textEl(x,y,t,anchor,size,color,bold=false,rot=0){
        const el=document.createElementNS('http://www.w3.org/2000/svg','text');
        el.setAttribute('x',x); el.setAttribute('y',y);
        el.setAttribute('text-anchor',anchor);
        el.setAttribute('font-size',size);
        el.setAttribute('fill',color);
        if(bold) el.setAttribute('font-weight','700');
        if(rot) el.setAttribute('transform',`rotate(${rot} ${x} ${y})`);
        el.textContent=t;
        svg.appendChild(el);
      }
    }
  </script>
</body>
</html>
